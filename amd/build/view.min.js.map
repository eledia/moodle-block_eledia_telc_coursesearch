{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//import $, { error } from 'jquery';\nimport $ from 'jquery';\nimport * as Repository from 'block_eledia_telc_coursesearch/repository';\nimport * as PagedContentFactory from 'core/paged_content_factory';\nimport * as PubSub from 'core/pubsub';\nimport * as CustomEvents from 'core/custom_interaction_events';\nimport * as Notification from 'core/notification';\nimport { exception as displayException } from 'core/notification';\nimport * as Templates from 'core/templates';\nimport * as CourseEvents from 'core_course/events';\nimport SELECTORS from 'block_eledia_telc_coursesearch/selectors';\nimport * as PagedContentEvents from 'core/paged_content_events';\nimport * as Aria from 'core/aria';\nimport { debounce } from 'core/utils';\nimport { setUserPreference } from 'core_user/repository';\n\nconst TEMPLATES = {\n    COURSES_CARDS: 'block_eledia_telc_coursesearch/view-cards',\n    COURSES_LIST: 'block_eledia_telc_coursesearch/view-list',\n    COURSES_SUMMARY: 'block_eledia_telc_coursesearch/view-summary',\n    NOCOURSES: 'core_course/no-courses'\n};\n\nconst GROUPINGS = {\n    GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n    GROUPING_ALL: 'all',\n    GROUPING_INPROGRESS: 'inprogress',\n    GROUPING_FUTURE: 'future',\n    GROUPING_PAST: 'past',\n    GROUPING_FAVOURITES: 'favourites',\n    GROUPING_HIDDEN: 'hidden'\n};\n\nconst NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\n\nlet loadedPages = [];\n\nlet courseOffset = 0;\n\nlet lastPage = 0;\n\nlet lastLimit = 0;\n\nlet namespace = null;\n\nlet selectedCategories = [];\nlet selectableCategories = [];\nlet selectedTags = [];\nlet selectableTags = [];\nlet customfields = [];\nlet filteredCustomfields = [];\nlet selectedCustomfields = [];\nlet searchTerm = '';\nlet catSearchTerm = '';\nlet tagsSearchTerm = '';\nlet courseInProgress = 'all';\nlet currentCustomField = 0;\n\n/**\n * Whether the summary display has been loaded.\n *\n * If true, this means that courses have been loaded with the summary text.\n * Otherwise, switching to the summary display mode will require course data to be fetched with the summary text.\n *\n * @type {boolean}\n */\nlet summaryDisplayLoaded = false;\n\n/**\n * Get filter values from DOM.\n *\n * @param {object} root The root element for the courses view.\n * @return {filters} Set filters.\n */\nconst getFilterValues = root => {\n    const courseRegion = root.find(SELECTORS.courseView.region);\n    return {\n        display: courseRegion.attr('data-display'),\n        grouping: courseRegion.attr('data-grouping'),\n        sort: courseRegion.attr('data-sort'),\n        displaycategories: courseRegion.attr('data-displaycategories'),\n        customfieldname: courseRegion.attr('data-customfieldname'),\n        customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n    };\n};\n\n/**\n * Get filter values from DOM and global variables.\n *\n * @param {object} root The root element for the courses view.\n * @return {filters} Set filters.\n */\n// eslint-disable-next-line no-unused-vars\nconst getAllFilterValues = root => {\n    const courseRegion = root.find(SELECTORS.courseView.region);\n    return {\n        display: courseRegion.attr('data-display'),\n        grouping: courseRegion.attr('data-grouping'),\n        sort: courseRegion.attr('data-sort'),\n        displaycategories: courseRegion.attr('data-displaycategories'),\n        customfields: customfields,\n        selectedCategories: selectedCategories,\n    };\n};\n\n// We want the paged content controls below the paged content area.\n// and the controls should be ignored while data is loading.\nconst DEFAULT_PAGED_CONTENT_CONFIG = {\n    ignoreControlWhileLoading: true,\n    controlPlacementBottom: true,\n    persistentLimitKey: 'block_eledia_telc_coursesearch_user_paging_preference'\n};\n\n/**\n * Get enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @param {object} searchParams The params.\n * @return {promise} Resolved with an array of courses.\n */\nconst getMyCourses = (filters, limit, searchParams) => {\n    const params = {\n        offset: courseOffset,\n        limit: limit,\n        classification: filters.grouping,\n        sort: filters.sort,\n        customfieldname: filters.customfieldname,\n        customfieldvalue: filters.customfieldvalue,\n    };\n    if (filters.display === 'summary') {\n        params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\n        summaryDisplayLoaded = true;\n    } else {\n        params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\n    }\n    return Repository.getEnrolledCoursesByTimeline(searchParams);\n};\n\n/**\n * Search for enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @param {string} searchValue What does the user want to search within their courses.\n * @return {promise} Resolved with an array of courses.\n */\nconst getSearchMyCourses = (filters, limit, searchValue) => {\n    const params = {\n        offset: courseOffset,\n        limit: limit,\n        classification: 'search',\n        sort: filters.sort,\n        customfieldname: filters.customfieldname,\n        customfieldvalue: filters.customfieldvalue,\n        searchvalue: searchValue,\n    };\n    if (filters.display === 'summary') {\n        params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\n        summaryDisplayLoaded = true;\n    } else {\n        params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\n        summaryDisplayLoaded = false;\n    }\n    return Repository.getEnrolledCoursesByTimeline(searchValue);\n};\n\n/**\n * Search for categories from backend.\n *\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchCategories = () => {\n    const params = getParams();\n    return Repository.getCategories(params);\n};\n\n/**\n * Search for tags from backend.\n *\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchTags = () => {\n    const params = getParams();\n    return Repository.getTags(params);\n};\n\n/**\n * Search for custom fields from backend.\n *\n * @return {promise} Resolved with an array of categories.\n */\nconst getSearchCustomfields = () => {\n    const params = getParams();\n    return Repository.getCustomfields(params);\n};\n\n/**\n * Get params for search\n *\n * @param {int} limit\n *\n * @return {Object} The favourite icon container\n */\nconst getParams = (limit = 0) => {\n    const params = {\n        criteria: [\n            {\n                key: \"categoryName\",\n                value: catSearchTerm,\n            },\n            {\n                key: \"tagsName\",\n                value: tagsSearchTerm,\n            },\n            {\n                key: 'name',\n                value: searchTerm,\n            },\n            {\n                key: 'selectedCategories',\n                categories: selectedCategories,\n            },\n            {\n                key: 'limit',\n                value: limit,\n            },\n            {\n                key: 'offset',\n                value: courseOffset,\n            },\n            {\n                key: 'progress',\n                value: courseInProgress,\n            },\n            {\n                key: 'currentCustomField',\n                value: currentCustomField,\n            },\n            {\n                key: 'selectedCustomfields',\n                customfields: getCustomFields(),\n            },\n            {\n                key: 'selectedTags',\n                tags: selectedTags,\n            },\n        ],\n        addsubcategories: true,\n    };\n    return params;\n};\n\n/**\n * Get params for search\n *\n * @return {Object} The favourite icon container\n */\nconst getCustomFields = () => {\n    if (!selectedCustomfields.length) {\n        return [];\n    }\n    const customFields = selectedCustomfields.map((values, key) => {\n        if (!values || values === undefined) {\n            return null;\n        }\n        const customValues = {\n            fieldid: key,\n            fieldvalues: values.map(val => val.value),\n        };\n        return customValues;\n    }).filter(Boolean);\n    return customFields;\n};\n\n/**\n * Get the container element for the favourite icon.\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n * @return {Object} The favourite icon container\n */\nconst getFavouriteIconContainer = (root, courseId) => {\n    return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the paged content container element.\n *\n * @param {Object} root The course overview container\n * @param {Number} index Rendered page index.\n * @return {Object} The rendered paged container.\n */\nconst getPagedContentContainer = (root, index) => {\n    return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n};\n\n/**\n * Get the course id from a favourite element.\n *\n * @param {Object} root The favourite icon container element.\n * @return {Number} Course id.\n */\nconst getCourseId = root => {\n    return root.attr('data-course-id');\n};\n\n/**\n * Hide the favourite icon.\n *\n * @param {Object} root The favourite icon container element.\n * @param {Number} courseId Course id number.\n */\nconst hideFavouriteIcon = (root, courseId) => {\n    const iconContainer = getFavouriteIconContainer(root, courseId);\n\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n    isFavouriteIcon.addClass('hidden');\n    Aria.hide(isFavouriteIcon);\n\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n    notFavourteIcon.removeClass('hidden');\n    Aria.unhide(notFavourteIcon);\n};\n\n/**\n * Show the favourite icon.\n *\n * @param {Object} root The course overview container.\n * @param {Number} courseId Course id number.\n */\nconst showFavouriteIcon = (root, courseId) => {\n    const iconContainer = getFavouriteIconContainer(root, courseId);\n\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n    isFavouriteIcon.removeClass('hidden');\n    Aria.unhide(isFavouriteIcon);\n\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n    notFavourteIcon.addClass('hidden');\n    Aria.hide(notFavourteIcon);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The add to favourite menu item.\n */\nconst getAddFavouriteMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The remove from favourites menu item.\n */\nconst getRemoveFavouriteMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Add course to favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst addToFavourites = (root, courseId) => {\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n    const addAction = getAddFavouriteMenuItem(root, courseId);\n\n    setCourseFavouriteState(courseId, true).then(success => {\n        if (success) {\n            PubSub.publish(CourseEvents.favourited, courseId);\n            removeAction.removeClass('hidden');\n            addAction.addClass('hidden');\n            showFavouriteIcon(root, courseId);\n        } else {\n            Notification.alert('Starring course failed', 'Could not change favourite state');\n        }\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Remove course from favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst removeFromFavourites = (root, courseId) => {\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n    const addAction = getAddFavouriteMenuItem(root, courseId);\n\n    setCourseFavouriteState(courseId, false).then(success => {\n        if (success) {\n            PubSub.publish(CourseEvents.unfavorited, courseId);\n            removeAction.addClass('hidden');\n            addAction.removeClass('hidden');\n            hideFavouriteIcon(root, courseId);\n        } else {\n            Notification.alert('Starring course failed', 'Could not change favourite state');\n        }\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The hide course menu item.\n */\nconst getHideCourseMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The show course menu item.\n */\nconst getShowCourseMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Hide course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst hideCourse = (root, courseId) => {\n    const hideAction = getHideCourseMenuItem(root, courseId);\n    const showAction = getShowCourseMenuItem(root, courseId);\n    const filters = getFilterValues(root);\n\n    setCourseHiddenState(courseId, true);\n\n    // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n        hideElement(root, courseId);\n    }\n\n    hideAction.addClass('hidden');\n    showAction.removeClass('hidden');\n};\n\n/**\n * Show course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst showCourse = (root, courseId) => {\n    const hideAction = getHideCourseMenuItem(root, courseId);\n    const showAction = getShowCourseMenuItem(root, courseId);\n    const filters = getFilterValues(root);\n\n    setCourseHiddenState(courseId, null);\n\n    // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n        hideElement(root, courseId);\n    }\n\n    hideAction.removeClass('hidden');\n    showAction.addClass('hidden');\n};\n\n/**\n * Set the courses hidden status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {Boolean} status new hidden status.\n * @return {Promise} Repository promise.\n */\nconst setCourseHiddenState = (courseId, status) => {\n\n    // If the given status is not hidden, the preference has to be deleted with a null value.\n    if (status === false) {\n        status = null;\n    }\n\n    return setUserPreference(`block_eledia_telc_coursesearch_hidden_course_${courseId}`, status)\n        .catch(Notification.exception);\n};\n\n/**\n * Reset the loadedPages dataset to take into account the hidden element\n *\n * @param {Object} root The course overview container\n * @param {Number} id The course id number\n */\nconst hideElement = (root, id) => {\n    const pagingBar = root.find('[data-region=\"paging-bar\"]');\n    const jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n    // Get a reduced dataset for the current page.\n    const courseList = loadedPages[jumpto];\n    let reducedCourse = courseList.courses.reduce((accumulator, current) => {\n        if (+id !== +current.id) {\n            accumulator.push(current);\n        }\n        return accumulator;\n    }, []);\n\n    // Get the next page's data if loaded and pop the first element from it.\n    if (typeof (loadedPages[jumpto + 1]) !== 'undefined') {\n        const newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n        // Adjust the dataset for the reset of the pages that are loaded.\n        loadedPages.forEach((courseList, index) => {\n            if (index > jumpto) {\n                let popElement = [];\n                if (typeof (loadedPages[index + 1]) !== 'undefined') {\n                    popElement = loadedPages[index + 1].courses.slice(0, 1);\n                }\n                loadedPages[index].courses = [...loadedPages[index].courses.slice(1), ...popElement];\n            }\n        });\n\n        reducedCourse = [...reducedCourse, ...newElement];\n    }\n\n    // Check if the next page is the last page and if it still has data associated to it.\n    if (lastPage === jumpto + 1 && loadedPages[jumpto + 1].courses.length === 0) {\n        const pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n        PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n    }\n\n    loadedPages[jumpto].courses = reducedCourse;\n\n    // Reduce the course offset.\n    courseOffset--;\n\n    // Render the paged content for the current.\n    const pagedContentPage = getPagedContentContainer(root, jumpto);\n    renderCourses(root, loadedPages[jumpto]).then((html, js) => {\n        return Templates.replaceNodeContents(pagedContentPage, html, js);\n    }).catch(Notification.exception);\n\n    // Delete subsequent pages in order to trigger the callback.\n    loadedPages.forEach((courseList, index) => {\n        if (index > jumpto) {\n            const page = getPagedContentContainer(root, index);\n            page.remove();\n        }\n    });\n};\n\n/**\n * Set the courses favourite status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {boolean} status new favourite status.\n * @return {Promise} Repository promise.\n */\nconst setCourseFavouriteState = (courseId, status) => {\n\n    return Repository.setFavouriteCourses({\n        courses: [\n            {\n                'id': courseId,\n                'favourite': status\n            }\n        ]\n    }).then(result => {\n        if (result.warnings.length === 0) {\n            loadedPages.forEach(courseList => {\n                courseList.courses.forEach((course, index) => {\n                    if (course.id == courseId) {\n                        courseList.courses[index].isfavourite = status;\n                    }\n                });\n            });\n            return true;\n        } else {\n            return false;\n        }\n    }).catch(Notification.exception);\n};\n\n/**\n * Given there are no courses to render provide the rendered template.\n *\n * @param {object} root The root element for the courses view.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst noCoursesRender = root => {\n    const nocoursesimg = root.find(SELECTORS.courseView.region).attr('data-nocoursesimg');\n    const newcourseurl = root.find(SELECTORS.courseView.region).attr('data-newcourseurl');\n    return Templates.render(TEMPLATES.NOCOURSES, {\n        nocoursesimg: nocoursesimg,\n        newcourseurl: newcourseurl\n    });\n};\n\n/**\n * Render the dashboard courses.\n *\n * @param {object} root The root element for the courses view.\n * @param {array} coursesData containing array of returned courses.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCourses = (root, coursesData) => {\n\n    const filters = getFilterValues(root);\n\n    let currentTemplate = '';\n    if (filters.display === 'card') {\n        currentTemplate = TEMPLATES.COURSES_CARDS;\n    } else if (filters.display === 'list') {\n        currentTemplate = TEMPLATES.COURSES_LIST;\n    } else {\n        currentTemplate = TEMPLATES.COURSES_SUMMARY;\n    }\n\n    if (!coursesData) {\n        return noCoursesRender(root);\n    } else {\n        // Sometimes we get weird objects coming after a failed search, cast to ensure typing functions.\n        if (Array.isArray(coursesData.courses) === false) {\n            coursesData.courses = Object.values(coursesData.courses);\n        }\n        // Whether the course category should be displayed in the course item.\n        coursesData.courses = coursesData.courses.map(course => {\n            course.showcoursecategory = filters.displaycategories === 'on';\n            return course;\n        });\n        if (coursesData.courses.length) {\n            return Templates.render(currentTemplate, {\n                courses: coursesData.courses,\n            });\n        } else {\n            return noCoursesRender(root);\n        }\n    }\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownContainer The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} categoriesData containing array of returned categories.\n * @param {array} selectionsData containing array of selected categories.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCategories = (dropdownContainer, dropdown, categoriesData, selectionsData, page) => {\n\n    // const filters = getFilterValues(categories);\n\n    const template = 'block_eledia_telc_coursesearch/nav-category-dropdown';\n\n    // NOTE: Render function for mustache.\n    return Templates.renderForPromise(template, {\n        categories: categoriesData,\n        catselections: selectionsData,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownContainer, html, js);\n        const catDropdown = page.querySelector(dropdown);\n        catDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownContainer The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} tagsData containing array of returned categories.\n * @param {array} selectionsData containing array of selected categories.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderTags = (dropdownContainer, dropdown, tagsData, selectionsData, page) => {\n\n    const template = 'block_eledia_telc_coursesearch/nav-tags-dropdown';\n\n    // NOTE: Render function for mustache.\n    return Templates.renderForPromise(template, {\n        tags: tagsData,\n        tagsselections: selectionsData,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownContainer, html, js);\n        const catDropdown = page.querySelector(dropdown);\n        catDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Render the categories in search dropdown.\n *\n * @param {string} dropdownContainer The categories element for the courses view.\n * @param {string} dropdown The categories element for the courses view.\n * @param {array} customfieldsData containing array of returned categories.\n * @param {array} selectionsData containing array of selected categories.\n * @param {object} page The page object.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCustomfields = (dropdownContainer, dropdown, customfieldsData, selectionsData, page) => {\n\n    const template = 'block_eledia_telc_coursesearch/nav-customfield-dropdown';\n\n    // NOTE: Render function for mustache.\n    return Templates.renderForPromise(template, {\n        customvalues: customfieldsData,\n        customselections: selectionsData,\n        customfieldid: currentCustomField,\n        description: document.querySelector(dropdownContainer).dataset.description,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownContainer, html, js);\n        const cuDropdown = page.querySelector(dropdown);\n        cuDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Return the callback to be passed to the subscribe event\n *\n * @param {object} root The root element for the courses view\n * @return {function} Partially applied function that'll execute when passed a limit\n */\nconst setLimit = root => {\n    // @param {Number} limit The paged limit that is passed through the event.\n    return limit => root.find(SELECTORS.courseView.region).attr('data-paging', limit);\n};\n\n/**\n * Intialise the paged list and cards views on page load.\n * Returns an array of paged contents that we would like to handle here\n *\n * @param {object} root The root element for the courses view\n * @param {string} namespace The namespace for all the events attached\n */\nconst registerPagedEventHandlers = (root, namespace) => {\n    const event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n    PubSub.subscribe(event, setLimit(root));\n};\n\n/**\n * Figure out how many items are going to be allowed to be rendered in the block.\n *\n * @param  {Number} pagingLimit How many courses to display\n * @param  {Object} root The course overview container\n * @return {Number[]} How many courses will be rendered\n */\nconst itemsPerPageFunc = (pagingLimit, root) => {\n    let itemsPerPage = NUMCOURSES_PERPAGE.map(value => {\n        let active = false;\n        if (value === pagingLimit) {\n            active = true;\n        }\n\n        return {\n            value: value,\n            active: active\n        };\n    });\n\n    // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n    const totalCourseCount = parseInt(root.find(SELECTORS.courseView.region).attr('data-totalcoursecount'), 10);\n    return itemsPerPage.filter(pagingOption => {\n        if (pagingOption.value === 0 && totalCourseCount > 100) {\n            // To minimise performance issues, do not show the \"All\" option\n            // if the user is enrolled in more than 100 courses.\n            return false;\n        }\n        return pagingOption.value < totalCourseCount;\n    });\n};\n\n/**\n * Mutates and controls the loadedPages array and handles the bootstrapping.\n *\n * @param {Array|Object} coursesData Array of all of the courses to start building the page from\n * @param {Number} currentPage What page are we currently on?\n * @param {Object} pageData Any current page information\n * @param {Object} actions Paged content helper\n * @param {null|boolean} activeSearch Are we currently actively searching and building up search results?\n */\nconst pageBuilder = (coursesData, currentPage, pageData, actions, activeSearch = null) => {\n    // If the courseData comes in an object then get the value otherwise it is a pure array.\n    let courses = coursesData.courses ? coursesData.courses : coursesData;\n    let nextPageStart = 0;\n    let pageCourses = [];\n\n    // If current page's data is loaded make sure we max it to page limit.\n    if (typeof (loadedPages[currentPage]) !== 'undefined') {\n        pageCourses = loadedPages[currentPage].courses;\n        const currentPageLength = pageCourses.length;\n        if (currentPageLength < pageData.limit) {\n            nextPageStart = pageData.limit - currentPageLength;\n            pageCourses = { ...loadedPages[currentPage].courses, ...courses.slice(0, nextPageStart) };\n        }\n    } else {\n        // When the page limit is zero, there is only one page of courses, no start for next page.\n        nextPageStart = pageData.limit || false;\n        pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n    }\n\n    // Finished setting up the current page.\n    loadedPages[currentPage] = {\n        courses: pageCourses\n    };\n\n    // Set up the next page (if there is more than one page).\n    const remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n    if (remainingCourses.length) {\n        loadedPages[currentPage + 1] = {\n            courses: remainingCourses\n        };\n    }\n\n    // Set the last page to either the current or next page.\n    if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n        lastPage = currentPage;\n        if (activeSearch === null) {\n            actions.allItemsLoaded(currentPage);\n        }\n    } else if (typeof (loadedPages[currentPage + 1]) !== 'undefined'\n        && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n        lastPage = currentPage + 1;\n    }\n\n    courseOffset = coursesData.nextoffset;\n};\n\n/**\n * In cases when switching between regular rendering and search rendering we need to reset some variables.\n */\nconst resetGlobals = () => {\n    courseOffset = 0;\n    loadedPages = [];\n    lastPage = 0;\n    lastLimit = 0;\n};\n\n/**\n * The default functionality of fetching paginated courses without special handling.\n *\n * @return {function(Object, Object, Object, Object, Object, Promise, Number, Object): void}\n */\nconst standardFunctionalityCurry = () => {\n    resetGlobals();\n    return (filters, currentPage, pageData, actions, root, promises, limit, searchParams) => {\n        const pagePromise = getMyCourses(\n            filters,\n            limit,\n            searchParams\n        ).then(coursesData => {\n            pageBuilder(coursesData, currentPage, pageData, actions);\n            return renderCourses(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        promises.push(pagePromise);\n    };\n};\n\n/**\n * Initialize the searching functionality so we can call it when required.\n *\n * @return {function(Object, Number, Object, Object, Object, Promise, Number, String): void}\n */\nconst searchFunctionalityCurry = () => {\n    resetGlobals();\n    return (filters, currentPage, pageData, actions, root, promises, limit, inputValue) => {\n        const searchingPromise = getSearchMyCourses(\n            filters,\n            limit,\n            inputValue\n        ).then(coursesData => {\n            const searchTerm = document.querySelector('.block-eledia_telc_coursesearch [data-action=\"search\"]').value;\n            if (searchTerm.trim() !== '') {\n                coursesData.courses.forEach(c => {\n                    const word = searchTerm.trim();\n                    const summary = c.summary;\n                    const fullname = c.fullname;\n                    const escapedWord = word.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n                    const regex = new RegExp(`(${escapedWord})`, 'gi');\n                    c.summary = summary.replace(regex, '<mark>$1</mark>');\n                    c.fullname = fullname.replace(regex, '<mark>$1</mark>');\n                });\n            }\n\n            pageBuilder(coursesData, currentPage, pageData, actions);\n            return renderCourses(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        promises.push(searchingPromise);\n    };\n};\n\n/**\n * Initialize the categoy searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst catSearchFunctionality = () => {\n    return (dropdownContainer, dropdown, page, selectedCategories) => {\n        const searchingPromise = getSearchCategories().then(categoriesData => {\n            // NOTE: Here it goes.\n            selectableCategories = categoriesData;\n            selectedCategories.forEach((selected) => {\n                const categoryIndex = selectableCategories.findIndex(item => item.id == selected.id);\n                if (categoryIndex !== -1) {\n                    selectableCategories.splice(categoryIndex, 1);\n                }\n            });\n            return renderCategories(dropdownContainer, dropdown, selectableCategories, selectedCategories, page);\n        }).catch(Notification.exception);\n\n        return searchingPromise;\n    };\n};\n\n/**\n * Initialize the tags searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst tagsSearchFunctionality = () => {\n    return (dropdownContainer, dropdown, page, selectedTags) => {\n        const searchingPromise = getSearchTags().then(tagsData => {\n            // NOTE: Here it goes.\n            selectableTags = tagsData;\n            selectedTags.forEach((selected) => {\n                const tagsIndex = selectableTags.findIndex(item => item.id == selected.id);\n                if (tagsIndex !== -1) {\n                    selectableTags.splice(tagsIndex, 1);\n                }\n            });\n            return renderTags(dropdownContainer, dropdown, selectableTags, selectedTags, page);\n        }).catch(Notification.exception);\n\n        return searchingPromise;\n    };\n};\n\n/**\n * Initialize the custom field searching functionality so we can call it when required.\n *\n * @return {function(Object): void}\n */\nconst customfieldSearchFunctionality = () => {\n    return (dropdownContainer, dropdown, page, searchterm) => {\n        const searchingPromise = getSearchCustomfields().then(customfieldsData => {\n            const noneOptionIndex = customfieldsData.findIndex(option => option.value === -1);\n            if (noneOptionIndex !== -1) {\n                customfieldsData.splice(noneOptionIndex, 1);\n            }\n            customfields[currentCustomField] = customfieldsData;\n            if (selectedCustomfields[currentCustomField] === undefined) {\n                selectedCustomfields[currentCustomField] = [];\n            }\n            selectedCustomfields[currentCustomField]?.forEach((selected) => {\n                const customfieldIndex = customfields[currentCustomField].findIndex(item => item.value === selected.value);\n                if (customfieldIndex !== -1) {\n                    customfields[currentCustomField].splice(customfieldIndex, 1);\n                }\n            });\n            filteredCustomfields[currentCustomField] = customfields[currentCustomField];\n            if (searchterm.trim() !== '') {\n                filteredCustomfields[currentCustomField] = filteredCustomfields[currentCustomField].filter(\n                    item => item.name.toLowerCase().includes(searchterm.trim().toLowerCase()));\n            }\n            return renderCustomfields(dropdownContainer,\n                dropdown,\n                filteredCustomfields[currentCustomField],\n                selectedCustomfields[currentCustomField],\n                page);\n        }).catch(Notification.exception);\n\n        return searchingPromise;\n    };\n};\n\n/**\n * Initialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n * @param {function} promiseFunction How do we fetch the courses and what do we do with them?\n * @param {null | string} inputValue What to search for\n * @param {object} params The params\n */\n// eslint-disable-next-line no-unused-vars\nconst initializePagedContent = (root, promiseFunction, inputValue = null, params) => {\n    const pagingLimit = parseInt(root.find(SELECTORS.courseView.region).attr('data-paging'), 10);\n    let itemsPerPage = itemsPerPageFunc(pagingLimit, root);\n\n    const config = { ...{}, ...DEFAULT_PAGED_CONTENT_CONFIG };\n    config.eventNamespace = namespace;\n\n    const pagedContentPromise = PagedContentFactory.createWithLimit(\n        itemsPerPage,\n        (pagesData, actions) => {\n            let promises = [];\n            pagesData.forEach(pageData => {\n                const currentPage = pageData.pageNumber;\n                let limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                // Reset local variables if limits have changed.\n                if (+lastLimit !== +limit) {\n                    loadedPages = [];\n                    courseOffset = 0;\n                    lastPage = 0;\n                }\n\n                if (lastPage === currentPage) {\n                    // If we are on the last page and have it's data then load it from cache.\n                    actions.allItemsLoaded(lastPage);\n                    promises.push(renderCourses(root, loadedPages[currentPage]));\n                    return;\n                }\n\n                lastLimit = limit;\n\n                // Get 2 pages worth of data as we will need it for the hidden functionality.\n                if (typeof (loadedPages[currentPage + 1]) === 'undefined') {\n                    if (typeof (loadedPages[currentPage]) === 'undefined') {\n                        limit *= 2;\n                    }\n                }\n\n                // Get the current applied filters.\n                const filters = getFilterValues(root);\n\n\n                // Call the curried function that'll handle the course promise and any manipulation of it.\n                promiseFunction(filters, currentPage, pageData, actions, root, promises, limit, params);\n            });\n            return promises;\n        },\n        config\n    );\n\n    pagedContentPromise.then((html, js) => {\n        registerPagedEventHandlers(root, namespace);\n        return Templates.replaceNodeContents(root.find(SELECTORS.courseView.region), html, js);\n    }).catch(Notification.exception);\n};\n\n/**\n * Initialise the list of categories in the search dropdown.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {object} page The page object.\n * @param {object} selectedCategories\n */\nconst initializeCategorySearchContent = (dropdownContainer,\n    dropdown,\n    promiseFunction,\n    page,\n    selectedCategories) => {\n    // eslint-disable-next-line no-unused-vars\n    const categories = promiseFunction(dropdownContainer,\n        dropdown,\n        page,\n        selectedCategories);\n};\n\n/**\n * Initialise the list of tags in the search dropdown.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {object} page The page object.\n * @param {object} selectedTags\n */\nconst initializeTagsSearchContent = (dropdownContainer,\n    dropdown,\n    promiseFunction,\n    page,\n    selectedTags) => {\n    // eslint-disable-next-line no-unused-vars\n    const categories = promiseFunction(dropdownContainer,\n        dropdown,\n        page,\n        selectedTags);\n};\n\n/**\n * Initialise the list of categories in the search dropdown.\n * TODO: Implement.\n *\n * @param {string} dropdownContainer The dropdown container element.\n * @param {string} dropdown The dropdown element for the search results.\n * @param {function} promiseFunction How do we fetch the categories and what do we do with them?\n * @param {object} page The page object.\n * @param {string} searchterm The current searchterm.\n */\nconst initializeCustomfieldSearchContent = (dropdownContainer,\n    dropdown,\n    promiseFunction,\n    page,\n    searchterm) => {\n    // eslint-disable-next-line no-unused-vars\n    const $customfields = promiseFunction(dropdownContainer,\n        dropdown,\n        page,\n        searchterm);\n};\n\n/**\n * Listen to, and handle events for the eledia_telc_coursesearch block.\n *\n * @param {Object} root The eledia_telc_coursesearch block container element.\n * @param {HTMLElement} page The whole HTMLElement for our block.\n */\nconst registerEventListeners = (root, page) => {\n\n    CustomEvents.define(root, [\n        CustomEvents.events.activate\n    ]);\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, (e, data) => {\n        const favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n        const courseId = getCourseId(favourite);\n        addToFavourites(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, (e, data) => {\n        const favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n        const courseId = getCourseId(favourite);\n        removeFromFavourites(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, (e, data) => {\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, (e, data) => {\n        const target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n        const courseId = getCourseId(target);\n        hideCourse(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, (e, data) => {\n        const target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n        const courseId = getCourseId(target);\n        showCourse(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    // Searching functionality event handlers.\n    const input = page.querySelector(SELECTORS.region.searchInput);\n    const clearIcon = page.querySelector(SELECTORS.region.clearIcon);\n    const catinput = page.querySelector(SELECTORS.cat.input);\n    const tagsinput = page.querySelector(SELECTORS.tags.input);\n    const customInputs = page.querySelectorAll(SELECTORS.customfields.input);\n    const clearCatIcon = page.querySelector(SELECTORS.cat.clearIcon);\n    const clearTagsIcon = page.querySelector(SELECTORS.tags.clearIcon);\n    const clearCustomfieldIcons = page.querySelectorAll(SELECTORS.customfields.clearIcon);\n    const customClass = SELECTORS.customfields.searchfield;\n    const catSelectable = SELECTORS.cat.selectableItem;\n    const catSelected = SELECTORS.cat.selectedItem;\n    const tagsSelectable = SELECTORS.tags.selectableItem;\n    const tagsSelected = SELECTORS.tags.selectedItem;\n    const customfieldSelectable = SELECTORS.customfields.selectableItem;\n    const customfieldSelected = SELECTORS.customfields.selectedItem;\n    const groupingFilter = page.querySelectorAll(SELECTORS.FILTER_GROUPING);\n\n    clearIcon.addEventListener('click', () => {\n        input.value = '';\n        searchTerm = '';\n        input.focus();\n        clearSearch(clearIcon, root);\n    });\n\n    clearCatIcon.addEventListener('click', () => {\n        catSearchTerm = '';\n        catinput.value = '';\n        catinput.focus();\n        clearCatSearch(clearCatIcon);\n        initializeCategorySearchContent(\n            SELECTORS.cat.dropdownDiv,\n            SELECTORS.cat.dropdown,\n            catSearchFunctionality(),\n            page,\n            selectedCategories);\n    });\n\n    clearTagsIcon.addEventListener('click', () => {\n        tagsSearchTerm = '';\n        tagsinput.value = '';\n        tagsinput.focus();\n        clearCatSearch(clearTagsIcon);\n        initializeTagsSearchContent(\n            SELECTORS.tags.dropdownDiv,\n            SELECTORS.tags.dropdown,\n            tagsSearchFunctionality(),\n            page,\n            selectedTags);\n    });\n\n    clearCustomfieldIcons.forEach(icon => {\n        currentCustomField = icon.dataset.customfieldid;\n        const customfieldInput = page.querySelector(customClass + currentCustomField);\n        icon.addEventListener('click', () => {\n            customfieldInput.value = '';\n            customfieldInput.focus();\n            clearCustomfieldSingleIconSearch(icon);\n            initializeCustomfieldSearchContent(\n                SELECTORS.customfields.dropdownDiv + currentCustomField,\n                SELECTORS.customfields.dropdown + currentCustomField,\n                customfieldSearchFunctionality(),\n                page,\n                '');\n        });\n    });\n\n    input.addEventListener('input', debounce(() => {\n        if (input.value === '') {\n            searchTerm = '';\n            clearSearch(clearIcon, root);\n        } else {\n            activeSearch(clearIcon);\n            searchTerm = input.value.trim();\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    }, 1000));\n\n    // Flow:\n    // eventListener\n    // initializeCustomfieldSearchContent()\n    // customfieldSearchFunctionality()\n    // renderCustomfields()\n    customInputs.forEach(i => {\n        i.addEventListener('click', (e) => {\n            currentCustomField = e.target.dataset.customfieldid;\n            const currentSearchterm = e.target.value.toLowerCase();\n            initializeCustomfieldSearchContent(\n                SELECTORS.customfields.dropdownDiv + currentCustomField,\n                SELECTORS.customfields.dropdown + currentCustomField,\n                customfieldSearchFunctionality(),\n                page,\n                currentSearchterm);\n        });\n        i.addEventListener('input', debounce((e) => {\n            currentCustomField = e.target.dataset.customfieldid;\n            const currentSearchterm = e.target.value.toLowerCase();\n            if (currentSearchterm === '') {\n                clearCustomfieldSearch(clearCustomfieldIcons);\n                manageCustomfielddropdownItems(\n                    e,\n                    customfieldSelected,\n                    customfieldSelectable,\n                    SELECTORS.customfields.dropdownDiv + currentCustomField,\n                    SELECTORS.customfields.dropdown + currentCustomField,\n                    customfieldSearchFunctionality(),\n                    page);\n            } else {\n                filteredCustomfields[currentCustomField] = filteredCustomfields[currentCustomField].filter(\n                    item => item.name.toLowerCase().includes(currentSearchterm.toLowerCase().trim()));\n                activeCustomfieldSearch(clearCustomfieldIcons);\n                manageCustomfielddropdownItems(\n                    e,\n                    customfieldSelected,\n                    customfieldSelectable,\n                    SELECTORS.customfields.dropdownDiv + currentCustomField,\n                    SELECTORS.customfields.dropdown + currentCustomField,\n                    customfieldSearchFunctionality(),\n                    page);\n            }\n        }, 1000));\n    });\n\n    // Initialize category search dropdown on first click.\n    catinput.addEventListener('click', () => {\n        initializeCategorySearchContent(\n            SELECTORS.cat.dropdownDiv,\n            SELECTORS.cat.dropdown,\n            catSearchFunctionality(),\n            page,\n            selectedCategories);\n    });\n\n    catinput.addEventListener('input', debounce(() => {\n        if (catinput.value === '') {\n            clearCatSearch(clearCatIcon);\n            catSearchTerm = '';\n            initializeCategorySearchContent(\n                SELECTORS.cat.dropdownDiv,\n                SELECTORS.cat.dropdown,\n                catSearchFunctionality(),\n                page,\n                selectedCategories);\n        } else {\n            activeSearch(clearCatIcon);\n            catSearchTerm = catinput.value.trim();\n            initializeCategorySearchContent(\n                SELECTORS.cat.dropdownDiv,\n                SELECTORS.cat.dropdown,\n                catSearchFunctionality(),\n                page,\n                selectedCategories);\n        }\n    }, 1000));\n\n    // Initialize tags search dropdown on first click.\n    tagsinput.addEventListener('click', () => {\n        initializeTagsSearchContent(\n            SELECTORS.tags.dropdownDiv,\n            SELECTORS.tags.dropdown,\n            tagsSearchFunctionality(),\n            page,\n            selectedTags);\n    });\n\n    tagsinput.addEventListener('input', debounce(() => {\n        if (tagsinput.value === '') {\n            clearCatSearch(clearTagsIcon);\n            tagsSearchTerm = '';\n            initializeTagsSearchContent(\n                SELECTORS.tags.dropdownDiv,\n                SELECTORS.tags.dropdown,\n                tagsSearchFunctionality(),\n                page,\n                selectedTags);\n        } else {\n            activeSearch(clearTagsIcon);\n            tagsSearchTerm = tagsinput.value.trim();\n            initializeTagsSearchContent(\n                SELECTORS.tags.dropdownDiv,\n                SELECTORS.tags.dropdown,\n                tagsSearchFunctionality(),\n                page,\n                selectedTags);\n        }\n    }, 1000));\n\n    document.body.addEventListener('click', manageCategorydropdownCollapse);\n    document.body.addEventListener('click', manageTagsdropdownCollapse);\n    document.body.addEventListener('click', manageCustomfielddropdownCollapse);\n\n    document.body.addEventListener('click', (e) => {\n        if (e.target.classList.contains(catSelected) || e.target.classList.contains(catSelectable)) {\n            e.preventDefault();\n            manageCategorydropdownItems(\n                e,\n                catSelected,\n                catSelectable,\n                SELECTORS.cat.dropdownDiv,\n                SELECTORS.cat.dropdown,\n                catSearchFunctionality(),\n                page);\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        if (e.target.classList.contains(tagsSelected) || e.target.classList.contains(tagsSelectable)) {\n            e.preventDefault();\n            manageTagsdropdownItems(\n                e,\n                tagsSelected,\n                tagsSelectable,\n                SELECTORS.tags.dropdownDiv,\n                SELECTORS.tags.dropdown,\n                tagsSearchFunctionality(),\n                page);\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        if (e.target.classList.contains(customfieldSelected) || e.target.classList.contains(customfieldSelectable)) {\n            e.preventDefault();\n            const currentId = e.target.dataset.customfieldid;\n            manageCustomfielddropdownItems(\n                e,\n                customfieldSelected,\n                customfieldSelectable,\n                SELECTORS.customfields.dropdownDiv + currentId,\n                SELECTORS.customfields.dropdown + currentId,\n                customfieldSearchFunctionality(),\n                page);\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        const expandLink = e.target;\n        if (expandLink.classList.contains('eledia-telc-expandsummary')) {\n            e.preventDefault();\n            const summary = e.target.previousElementSibling;\n            expandLink.classList.add('d-none');\n            summary.classList.remove('summary-fadeout');\n        }\n    });\n\n    document.body.addEventListener('click', (e) => {\n        const collapseLink = e.target;\n        if (collapseLink.classList.contains('eledia-telc-collapsesummary')) {\n            e.preventDefault();\n            const summary = e.target.parentElement;\n            const expandLink = summary.nextElementSibling;\n            expandLink.classList.remove('d-none');\n            summary.classList.add('summary-fadeout');\n        }\n    });\n\n    groupingFilter.forEach(filter => {\n        const filterType = filter.dataset.value;\n        filter.addEventListener('click', () => {\n            courseInProgress = filterType;\n        });\n    });\n\n};\n\n/**\n * Reset the search icon and trigger the init for the block.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n * @param {Object} root The eledia_telc_coursesearch block container element.\n */\nexport const clearSearch = (clearIcon, root) => {\n    clearIcon.classList.add('d-none');\n    init(root);\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} clearCatIcon Our closing icon to manipulate.\n */\nexport const clearCatSearch = (clearCatIcon) => {\n    clearCatIcon.classList.add('d-none');\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} clearCustomfieldIcons Our closing icon to manipulate.\n */\nexport const clearCustomfieldSearch = (clearCustomfieldIcons) => {\n    clearCustomfieldIcons.forEach(icon => {\n        if (icon.dataset.customfieldid === currentCustomField) {\n            icon.classList.add('d-none');\n        }\n    });\n};\n\n/**\n * Reset the search icon and trigger the init for the category search.\n *\n * @param {HTMLElement} icon Our closing icon to manipulate.\n */\nexport const clearCustomfieldSingleIconSearch = icon => { icon.classList.add('d-none'); };\n\n/**\n * Change the searching icon to its' active state. *\n *\n * @param {HTMLElement} clearCustomfieldIcons Our closing icon to manipulate.\n */\nexport const activeCustomfieldSearch = (clearCustomfieldIcons) => {\n    clearCustomfieldIcons.forEach(icon => {\n        if (icon.dataset.customfieldid === currentCustomField) {\n            icon.classList.remove('d-none');\n        }\n    });\n};\n\n/**\n * Change the searching icon to its' active state.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n */\nconst activeSearch = (clearIcon) => {\n    clearIcon.classList.remove('d-none');\n};\n\n/**\n * Hide category dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n */\nconst manageCategorydropdownCollapse = (e) => {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const catDropdown = page.querySelector(SELECTORS.cat.dropdown);\n    if (!e.target.classList.contains('catprevent') && !e.target.classList.contains('fa-xmark')) {\n        catDropdown.style.display = 'none';\n    } else if (e.target.classList.contains('catprevent') && !e.target.classList.contains('fa-xmark')) {\n        catDropdown.style.display = 'block';\n    }\n\n};\n\n/**\n * Hide tags dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n */\nconst manageTagsdropdownCollapse = (e) => {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const tagsDropdown = page.querySelector(SELECTORS.tags.dropdown);\n    if (!e.target.classList.contains('tagsprevent') && !e.target.classList.contains('fa-xmark')) {\n        tagsDropdown.style.display = 'none';\n    } else if (e.target.classList.contains('tagsprevent') && !e.target.classList.contains('fa-xmark')) {\n        tagsDropdown.style.display = 'block';\n    }\n\n};\n\n/**\n * TODO: complete\n * Hide category dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n * @param {string} selected\n * @param {string} selectable\n * @param {string} dropdownDiv\n * @param {string} dropdown\n * @param {object} promiseFunction\n * @param {object} page\n **/\nconst manageCategorydropdownItems = (e, selected, selectable, dropdownDiv, dropdown, promiseFunction, page) => {\n    const template = 'block_eledia_telc_coursesearch/nav-category-dropdown';\n    const categoryId = e.target.dataset.catId;\n    if (e.target.classList.contains(selectable)) {\n        const categoryIndex = selectableCategories.findIndex(value => value.id == categoryId);\n        selectedCategories.push(selectableCategories.splice(categoryIndex, 1)[0]);\n    } else {\n        const categoryIndex = selectedCategories.findIndex(value => value.id == categoryId);\n        selectableCategories.push(selectedCategories.splice(categoryIndex, 1)[0]);\n    }\n    renderSelectOptions();\n    return Templates.renderForPromise(template, {\n        categories: selectableCategories,\n        catselections: selectedCategories,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownDiv, html, js);\n        const catDropdown = page.querySelector(dropdown);\n        catDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * TODO: complete\n * Hide category dropdown if clicked outside category search.\n *\n * @param {PointerEvent} e a click.\n * @param {string} selected\n * @param {string} selectable\n * @param {string} dropdownDiv\n * @param {string} dropdown\n * @param {object} promiseFunction\n * @param {object} page\n **/\nconst manageTagsdropdownItems = (e, selected, selectable, dropdownDiv, dropdown, promiseFunction, page) => {\n    const template = 'block_eledia_telc_coursesearch/nav-tags-dropdown';\n    const tagsId = e.target.dataset.tagsId;\n    if (e.target.classList.contains(selectable)) {\n        const tagsIndex = selectableTags.findIndex(value => value.id == tagsId);\n        selectedTags.push(selectableTags.splice(tagsIndex, 1)[0]);\n    } else {\n        const tagsIndex = selectedTags.findIndex(value => value.id == tagsId);\n        selectableTags.push(selectedTags.splice(tagsIndex, 1)[0]);\n    }\n    renderSelectOptions();\n    return Templates.renderForPromise(template, {\n        tags: selectableTags,\n        tagsselections: selectedTags,\n    }).then(({ html, js }) => {\n        const renderResult = Templates.replaceNodeContents(dropdownDiv, html, js);\n        const tagsDropdown = page.querySelector(dropdown);\n        tagsDropdown.style.display = 'block';\n        return renderResult;\n    }).catch(error => displayException(error));\n};\n\n/**\n * Hide customfield dropdown if clicked outside customfield search.\n *\n */\nconst manageCustomfielddropdownCollapse = () => {\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const customfieldDropdowns = page.querySelectorAll(SELECTORS.customfields.dropdownAll);\n    customfieldDropdowns.forEach(dropdown => {\n        if (!dropdown.classList.contains(SELECTORS.customfields.dropdown + currentCustomField)) {\n            dropdown.style.display = 'none';\n        } else {\n            dropdown.style.display = 'block';\n        }\n    });\n\n};\n\n/**\n * Hide customfield dropdown if clicked outside customfield search.\n *\n * @param {PointerEvent} e a click.\n * @param {string} selected\n * @param {string} selectable\n * @param {string} dropdownDiv\n * @param {string} dropdown\n * @param {object} promiseFunction\n * @param {object} page\n **/\nconst manageCustomfielddropdownItems = (e, selected, selectable, dropdownDiv, dropdown, promiseFunction, page) => {\n    // const template = 'block_eledia_telc_coursesearch/nav-customfield-dropdown';\n    const customfieldValue = e.target.dataset.selectvalue;\n    const customfieldName = e.target.dataset.selectname;\n    const customfieldId = e.target.dataset.customfieldid;\n    if (e.target.classList.contains(selectable)) {\n        const customfieldIndex = filteredCustomfields[customfieldId].findIndex(item => item.value == customfieldValue);\n        selectedCustomfields[customfieldId].push(filteredCustomfields[customfieldId].splice(customfieldIndex, 1)[0]);\n        selectedCustomfields[customfieldId].sort((a, b) => {\n            return ('' + a.name).localeCompare(b.name);\n        });\n        //filteredCustomfields[customfieldId].splice(\n        //    filteredCustomfields[customfieldId].findIndex(item => item.value == customfieldValue),\n        //    1);\n    } else if (e.target.classList.contains(selected)) {\n        const customfieldIndex = selectedCustomfields[customfieldId].findIndex(item => item.value == customfieldValue);\n        const interchangedValue = selectedCustomfields[customfieldId].splice(customfieldIndex, 1)[0];\n        // customfields[customfieldId].push(interchangedValue);\n        const searchField = page.querySelector(\".customsearch-\" + customfieldId);\n        if (searchField.value === '' || customfieldName.toLowerCase().includes(searchField.value.trim().toLowerCase())) {\n            filteredCustomfields[customfieldId].push(interchangedValue);\n        }\n        filteredCustomfields[customfieldId].sort((a, b) => {\n            return ('' + a.name).localeCompare(b.name);\n        });\n    }\n    renderSelectOptions();\n    return renderCustomfields(dropdownDiv,\n        dropdown,\n        filteredCustomfields[customfieldId],\n        selectedCustomfields[customfieldId],\n        page);\n};\n\n/**\n * Intialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n */\nexport const init = root => {\n    root = $(root);\n    loadedPages = [];\n    lastPage = 0;\n    courseOffset = 0;\n\n    if (!root.attr('data-init')) {\n        const page = document.querySelector(SELECTORS.region.selectBlock);\n        registerEventListeners(root, page);\n        namespace = \"block_eledia_telc_coursesearch_\" + root.attr('id') + \"_\" + Math.random();\n        root.attr('data-init', true);\n    }\n\n    initializePagedContent(root, standardFunctionalityCurry(), null, getParams());\n};\n\n/**\n * Reset the courses views to their original\n * state on first page load.courseOffset\n *\n * This is called when configuration has changed for the event lists\n * to cause them to reload their data.\n *\n * @param {Object} root The root element for the timeline view.\n */\nexport const reset = root => {\n    if (loadedPages.length > 0) {\n        const filters = getFilterValues(root);\n        // If the display mode is changed to 'summary' but the summary display has not been loaded yet,\n        // we need to re-fetch the courses to include the course summary text.\n        if (filters.display === 'summary' && !summaryDisplayLoaded) {\n            const page = document.querySelector(SELECTORS.region.selectBlock);\n            const input = page.querySelector(SELECTORS.region.searchInput);\n            if (input.value !== '') {\n                initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\n            } else {\n                initializePagedContent(root, standardFunctionalityCurry());\n            }\n        } else {\n            loadedPages.forEach((courseList, index) => {\n                let pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then((html, js) => {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        }\n    } else {\n        init(root);\n    }\n};\n\n/**\n * Renders the selected option items.\n *\n */\nfunction renderSelectOptions() {\n    let options = [];\n\n    selectedCustomfields.forEach((subArray, subIndex) => {\n        subArray.forEach((option, index) => {\n            options.push({\n                index: subIndex,\n                description: option.name,\n                type: 'customfield',\n                cindex: index\n            });\n        });\n    });\n\n    selectedCategories.forEach((option, index) => {\n        options.push({\n            index: index,\n            description: option.name,\n            type: 'category',\n            cindex: 0\n        });\n    });\n\n    selectedTags.forEach((option, index) => {\n        options.push({\n            index: index,\n            description: option.name,\n            type: 'tag',\n            cindex: 0\n        });\n    });\n    Templates.renderForPromise('block_eledia_telc_coursesearch/nav-selected-option-items', {\n        options: options\n    }).then(({ html, js }) => {\n        return Templates.replaceNodeContents('.coursesearchitems', html, js);\n    }).catch(error => displayException(error));\n}\n\n/**\n * Deletes a selected option item.\n * @param {string} type The type of the option (category, tag, customfield).\n * @param {number} index The index of the option in its array.\n * @param {number} cindex The customfield subindex (only for customfields).\n */\nfunction deleteSelectOption(type, index, cindex) {\n    switch (type) {\n        case 'category': {\n            if (selectedCategories[index]) {\n                selectableCategories.push(selectedCategories.splice(index, 1)[0]);\n            }\n            break;\n        }\n        case 'tag': {\n            if (selectedTags[index]) {\n                selectableTags.push(selectedTags.splice(index, 1)[0]);\n            }\n            break;\n        }\n        case 'customfield': {\n            if (selectedCustomfields[index] && selectedCustomfields[index][cindex]) {\n                const interchangedValue = selectedCustomfields[index].splice(cindex, 1)[0];\n                filteredCustomfields[index].push(interchangedValue);\n                filteredCustomfields[index].sort((a, b) => {\n                    return ('' + a.name).localeCompare(b.name);\n                });\n            }\n            break;\n        }\n        default:\n            throw new Error('Invalid type \"' + type + '\" for deleteSelectOption');\n    }\n    renderSelectOptions();\n    // Fetch and render courses again.\n    const page = document.querySelector(SELECTORS.region.selectBlock);\n    const root = $(page);\n    const input = page.querySelector(SELECTORS.region.searchInput);\n    initializePagedContent(root, searchFunctionalityCurry(), input.value.trim(), getParams());\n}\n\n/**\n * Event listener for deleting selected option items.\n */\ndocument.body.addEventListener('click', (e) => {\n    const cancelBtn = e.target.closest('.selected-option-cancelbtn');\n    if (cancelBtn) {\n        e.preventDefault();\n        const type = cancelBtn.dataset.type;\n        const index = parseInt(cancelBtn.dataset.index);\n        const cindex = parseInt(cancelBtn.dataset.cindex);\n        deleteSelectOption(type, index, cindex);\n    }\n});\n"],"names":["TEMPLATES","GROUPINGS","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","selectedCategories","selectableCategories","selectedTags","selectableTags","customfields","filteredCustomfields","selectedCustomfields","searchTerm","catSearchTerm","tagsSearchTerm","courseInProgress","currentCustomField","summaryDisplayLoaded","getFilterValues","root","courseRegion","find","SELECTORS","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getParams","limit","params","criteria","key","value","categories","getCustomFields","tags","addsubcategories","length","map","values","undefined","fieldid","fieldvalues","val","filter","Boolean","getFavouriteIconContainer","courseId","FAVOURITE_ICON","getPagedContentContainer","index","getCourseId","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","PubSub","publish","CourseEvents","favourited","removeClass","addClass","iconContainer","isFavouriteIcon","ICON_IS_FAVOURITE","Aria","unhide","notFavourteIcon","ICON_NOT_FAVOURITE","hide","showFavouriteIcon","Notification","alert","catch","exception","removeFromFavourites","unfavorited","hideFavouriteIcon","getHideCourseMenuItem","getShowCourseMenuItem","setCourseHiddenState","status","hideElement","id","pagingBar","jumpto","parseInt","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","courseList","popElement","pagedContentContainer","PagedContentFactory","resetLastPageNumber","pagedContentPage","renderCourses","html","js","Templates","replaceNodeContents","remove","Repository","setFavouriteCourses","result","warnings","course","isfavourite","noCoursesRender","nocoursesimg","newcourseurl","render","coursesData","filters","currentTemplate","Array","isArray","Object","showcoursecategory","renderCustomfields","dropdownContainer","dropdown","customfieldsData","selectionsData","page","renderForPromise","customvalues","customselections","customfieldid","description","document","querySelector","dataset","_ref3","renderResult","style","error","registerPagedEventHandlers","event","PagedContentEvents","SET_ITEMS_PER_PAGE_LIMIT","subscribe","setLimit","itemsPerPageFunc","pagingLimit","itemsPerPage","active","totalCourseCount","pagingOption","pageBuilder","currentPage","pageData","actions","activeSearch","nextPageStart","pageCourses","currentPageLength","remainingCourses","allItemsLoaded","nextoffset","resetGlobals","standardFunctionalityCurry","promises","searchParams","pagePromise","offset","classification","requiredfields","SUMMARY_REQUIRED_FIELDS","CARDLIST_REQUIRED_FIELDS","getEnrolledCoursesByTimeline","getMyCourses","searchFunctionalityCurry","inputValue","searchingPromise","searchValue","searchvalue","getSearchMyCourses","trim","c","word","summary","fullname","escapedWord","replace","regex","RegExp","catSearchFunctionality","getCategories","getSearchCategories","categoriesData","selected","categoryIndex","findIndex","item","splice","catselections","_ref","renderCategories","tagsSearchFunctionality","getTags","getSearchTags","tagsData","tagsIndex","tagsselections","_ref2","renderTags","customfieldSearchFunctionality","searchterm","getCustomfields","getSearchCustomfields","noneOptionIndex","option","customfieldIndex","name","toLowerCase","includes","initializePagedContent","promiseFunction","config","eventNamespace","pagedContentPromise","createWithLimit","pagesData","pageNumber","initializeCategorySearchContent","initializeTagsSearchContent","initializeCustomfieldSearchContent","registerEventListeners","CustomEvents","define","events","activate","on","ACTION_ADD_FAVOURITE","e","data","favourite","target","closest","originalEvent","preventDefault","ACTION_REMOVE_FAVOURITE","ACTION_HIDE_COURSE","hideAction","showAction","hideCourse","ACTION_SHOW_COURSE","showCourse","input","searchInput","clearIcon","catinput","cat","tagsinput","customInputs","querySelectorAll","clearCatIcon","clearTagsIcon","clearCustomfieldIcons","customClass","searchfield","catSelectable","selectableItem","catSelected","selectedItem","tagsSelectable","tagsSelected","customfieldSelectable","customfieldSelected","groupingFilter","FILTER_GROUPING","addEventListener","focus","clearSearch","clearCatSearch","dropdownDiv","icon","customfieldInput","clearCustomfieldSingleIconSearch","i","currentSearchterm","clearCustomfieldSearch","manageCustomfielddropdownItems","activeCustomfieldSearch","body","manageCategorydropdownCollapse","manageTagsdropdownCollapse","manageCustomfielddropdownCollapse","classList","contains","manageCategorydropdownItems","manageTagsdropdownItems","currentId","expandLink","previousElementSibling","add","parentElement","nextElementSibling","filterType","init","catDropdown","selectBlock","tagsDropdown","selectable","categoryId","catId","renderSelectOptions","_ref4","tagsId","_ref5","dropdownAll","customfieldValue","selectvalue","customfieldName","selectname","customfieldId","a","b","localeCompare","interchangedValue","searchField","Math","random","options","subArray","subIndex","type","cindex","_ref6","cancelBtn","Error","deleteSelectOption"],"mappings":"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"}